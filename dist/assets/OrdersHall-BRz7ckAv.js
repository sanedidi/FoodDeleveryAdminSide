import{r as i,u as I,j as e,L as q,B as o,x as O}from"./index-DSiRzrbg.js";import{_ as b,I as D,H as E,S as F,a as w}from"./MainProd-DW19dvKP.js";import{C as H}from"./chunk-BTVB6U66-BfmmzTpC.js";import{r as g}from"./index-C0teDyxI.js";import{c as A,f as L}from"./free-FCPvG2o0.js";import"./chunk-DEQZ7DVA-L72d_YGu.js";const $="_orders_1x4kn_1",T="_orders__left_1x4kn_10",z="_orders__header_1x4kn_19",M="_orders__input_1x4kn_24",Q="_orders__add_btn_1x4kn_28",R="_orders__cat_1x4kn_31",U="_orders__active_1x4kn_54",Z="_orders__items_1x4kn_58",G="_orders__button_1x4kn_64",J="_orders__title_1x4kn_76",K="_orders__product_1x4kn_82",V="_orders__desc_1x4kn_97",W="_orders__price_1x4kn_102",X="_orders__prod_title_1x4kn_114",Y="_orders__products_1x4kn_120",ee="_orders__right_1x4kn_145",re="_orders__info_1x4kn_150",se="_orders__main_info_1x4kn_159",te="_orders__client_1x4kn_164",oe="_orders_item_1x4kn_172",_e="_orders__calendar_1x4kn_176",ne="_orders__client_title_1x4kn_183",de="_orders__prod_img_1x4kn_187",ae="_orders__ordered_1x4kn_196",ce="_orders__ordered_info_1x4kn_206",ie="_orders__productItem_1x4kn_215",le="_orders__label_1x4kn_224",pe="_quantityControl_1x4kn_233",me="_orders__total_1x4kn_247",he="_paymentButtons_1x4kn_258",ue="_submit_button_1x4kn_274",xe="_active_1x4kn_278",r={orders:$,orders__left:T,orders__header:z,orders__input:M,orders__add_btn:Q,orders__cat:R,orders__active:U,orders__items:Z,orders__button:G,orders__title:J,orders__product:K,orders__desc:V,orders__price:W,orders__prod_title:X,orders__products:Y,orders__right:ee,orders__info:re,orders__main_info:se,orders__client:te,orders_item:oe,orders__calendar:_e,orders__client_title:ne,orders__prod_img:de,orders__ordered:ae,orders__ordered_info:ce,orders__productItem:ie,orders__label:le,quantityControl:pe,orders__total:me,paymentButtons:he,submit_button:ue,active:xe},fe=()=>{const[k,p]=i.useState([]),[y,j]=i.useState([]),[N,v]=i.useState([]),[m,h]=i.useState(null),[u,C]=i.useState(0),[l,x]=i.useState({payment_type:"",products:[],branch_id:""}),P=I();return i.useEffect(()=>{(async()=>{try{const a=(await g.get("https://food-delivery-api-n6as.onrender.com/v1/branches")).data.Data.branches.map(_=>({value:_.id,label:_.name}));p(a)}catch(t){console.error("Failed to fetch branches",t)}})()},[]),i.useEffect(()=>{(async()=>{try{const a=(await g.get("https://food-delivery-api-n6as.onrender.com/v1/products")).data.Data.products.map(_=>({value:_.id,label:_.name,category_id:_.category_id,photo:_.photo,name:_.name,desc:_.description,price:_.sale_price}));j(a)}catch(t){console.error("Failed to fetch products",t)}})()},[]),i.useEffect(()=>{(async()=>{try{const a=(await g.get("https://food-delivery-api-n6as.onrender.com/v1/categories",{params:{limit:1e15}})).data.Data.categories.map(_=>({value:_.id,label:_.name,photo:_.photo}));v(a)}catch(t){console.error("Failed to fetch categories",t)}})()},[]),{branchOptions:k,prodOptions:y,categories:N,selectedCategory:m,setSelectedCategory:h,totalAmount:u,orderDetails:l,handleInputChange:(c,t)=>{x(a=>({...a,[c]:t}))},handleProductChange:(c,t)=>{const a=l.products.findIndex(n=>n.id===c);if(a!==-1){const n=[...l.products];n[a].quantity+=t,n[a].quantity<0&&(n[a].quantity=0),x(B=>({...B,products:n}))}else x(n=>({...n,products:[...n.products,{id:c,quantity:t}]}));const S=y.find(n=>n.value===c).price*t;C(n=>n+S)},handleSubmit:async()=>{if(!l.payment_type){b.error("Пожалуйста, выберите способ оплаты.");return}if(!l.products.some(t=>t.quantity>0)){b.error("Пожалуйста, выберите продукты для заказа.");return}try{await g.post("https://food-delivery-api-n6as.onrender.com/v1/order_h",l),b.success("Заказ успешно создан!"),setTimeout(()=>{P("/admin/orders")},1e3)}catch(t){b.error("Ошибка при создании заказа",t)}}}},ve=()=>{const{branchOptions:k,prodOptions:p,categories:y,selectedCategory:j,setSelectedCategory:N,totalAmount:v,orderDetails:m,handleInputChange:h,handleProductChange:u,handleSubmit:C}=fe(),l=j?p.filter(s=>s.category_id===j):p,x=m.products.filter(s=>s.quantity>0),P=(s,f)=>{const d=parseInt(f,10);!isNaN(d)&&d>=0&&u(s,d-m.products.find(c=>c.id===s).quantity)};return e.jsxs(e.Fragment,{children:[e.jsx(D,{}),e.jsx(E,{title:e.jsxs(q,{to:"/admin/orders",className:r.orders__header,children:[e.jsx(H,{fontSize:"14px"}),e.jsx("p",{to:"/admin/orders",children:"Список товаров"})]}),headerBtn2:e.jsx(e.Fragment,{children:e.jsx(F,{options:k,placeholder:"Выберите Филлиал",onChange:s=>h("branch_id",s.value)})})}),e.jsxs(o,{className:r.orders,children:[e.jsxs(o,{className:r.orders__left,children:[e.jsx("h2",{className:r.orders__title,children:"Категории"}),e.jsx(o,{className:r.orders__items,children:y.map(s=>e.jsxs(o,{className:`${r.orders__cat} ${j===s.value?r.orders__active:""}`,onClick:()=>N(s.value),children:[e.jsx("img",{src:s.photo,alt:s.label}),e.jsx("h2",{children:s.label})]},s.value))})]}),e.jsxs(o,{className:r.orders__right,children:[e.jsx(o,{className:r.orders__products,children:l.map((s,f)=>e.jsxs(o,{onClick:()=>u(s.value,1),className:r.orders__product,children:[e.jsx(o,{className:r.orders__prod_imh,children:e.jsx("img",{src:s.photo,alt:""})}),e.jsxs(o,{className:r.orders__desc,children:[e.jsx("p",{className:r.orders__prod_title,children:s.label}),e.jsx("p",{className:r.orders_button,children:s.desc})]}),e.jsxs(o,{className:r.orders__price,children:[e.jsxs("p",{className:r.orders__button,children:[e.jsx("span",{children:s.price})," сум"]}),e.jsx("button",{children:"Добавить"})]})]},f))}),e.jsxs(o,{className:r.orders__info,children:[e.jsx("h2",{className:r.orders__client_title,children:"Заказ инфо"}),e.jsx(o,{className:r.orders__ordered,children:x.length>0?x.map((s,f)=>e.jsxs("div",{className:r.orders__productItem,children:[e.jsx(o,{className:r.orders__prod_img,children:e.jsx("img",{src:p.find(d=>d.value===s.id).photo,alt:""})}),e.jsxs(o,{className:r.orders__ordered_info,children:[e.jsx("p",{className:r.orders__label,children:p.find(d=>d.value===s.id).label}),e.jsxs("p",{className:r.orders__label,children:[p.find(d=>d.value===s.id).price,"сум"]})]}),e.jsxs("div",{className:r.quantityControl,children:[e.jsx("button",{className:r.orders__add_btn,onClick:()=>u(s.id,-1),children:"-"}),e.jsx("input",{className:r.orders__input,value:s.quantity,onChange:d=>P(s.id,d.target.value)}),e.jsx("button",{className:r.orders__add_btn,onClick:()=>u(s.id,1),children:"+"})]})]},f)):e.jsx(o,{className:r.orders__ordered_info,children:"Выберите продукт для заказа"})}),e.jsx(o,{className:r.orders__total,children:e.jsxs("p",{children:["Общяя сумма: ",e.jsxs("span",{children:[" ",v," UZS"]})]})}),e.jsxs(o,{className:r.paymentButtons,children:[e.jsx("button",{className:m.payment_type==="click"?r.active:"",onClick:()=>h("payment_type","click"),children:e.jsx(O,{})}),e.jsx("button",{className:m.payment_type==="наличные"?r.active:"",onClick:()=>h("payment_type","наличные"),children:e.jsx("img",{src:A,alt:""})}),e.jsx("button",{className:m.payment_type==="free"?r.active:"",onClick:()=>h("payment_type","free"),children:e.jsx("img",{src:L,alt:""})})]}),e.jsx(w,{BgColor:"blue",BtnContent:"Создать заказ",Onclick:C,type:"button"})]})]})]})]})};export{ve as OrdersHall,ve as default};
